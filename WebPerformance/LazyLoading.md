# Lazy Loading
- 지연 로딩은 여러 개념으로 사용된다.

## 백앤드에서의 지연 로딩
- 주로 백앤드에서는 ORM을 사용할 때 eager loading과 lazy loading을 구분해서 쿼리의 결과 리스트를 가져올 때, 리스트의 일부 또는 단일 결과값에 연관된 데이터에 대한 쿼리를 한 번 더 날리기 위해 lazy loading을 사용한다. lazy loading은 쿼리의 결과 리스트 하나하나에 대해 쿼리를 날리는 방식이고 eager loading은 미리 결과 리스트에 대한 연관 데이터를 모두 한꺼번에 가져오는 방식이다. 가져와야 할 결과 리스트의 크기가 크다면 eager loading 보다는 lazy loading을 사용하는 것이 DB의 리소스에 부담을 적게 주고 백앤드 애플리케이션의 메모리 절감을 할 수 있는 전략이다. 물론 데이터의 크기가 작다면 한꺼번에 빠르게 데이터를 가져올 수 있고 여러번 나눠서 쿼리를 날리는 것 보다 단일 또는 소수의 쿼리로 데이터를 가져오는 eager loading이 더 나을 때도 있다.

## 프론트앤드에서의 지연 로딩
- 프론트엔드에서 보통 lazy loading이라고 하면 브라우저가 초기 랜더링 될 때가 아니라, 랜더링 된 이후 브라우저의 이벤트 발생을 통해서 로딩을 한다는 의미이다.
- 보통 프론트앤드에서 로딩이라고 하면 통신을 통해서 가져오는 데이터의 lazy loading을 의미한다. 물론 Lazy Loading의 개념에는 자바스크립트 자체의 갑작스런 리소스 소모를 줄이기 위해서 코드의 실행을 나중에 실행한다는 개념도 포함한다.
- lazy loading의 대상은 이미지 뿐만 아니라, CSS 파일, 자바스크립트 통신으로 가져오는 모든 것이 대상이 될 수 있다.

## Lazy Loading을 사용하는 이유
- 예를 들어 웹 페이지에 사진이 엄청 많이 로딩 된다고 하자. 
- 페이지 상단에 보여 줄 이미지를 로딩을 하는데, 페이지 하단의 이미지를 로딩하기 위해서 페이지 상단의 이미지 로딩이 지연된다고 생각해 보자. 유저 경험(UX)적인 측면에서 불편함을 주게 된다.
- 그래서 페이지의 이미지를 로딩할 때 페이지 상단의 이미지부터 로딩 될 수 있도록 하는 편이 좋고, 가능하다면 맨 윗 라인 부터 차례로 로딩되게 하는 것이 좋다.

### HTTP와 HTTP2
- 서버에서 클라이언트와 HTTP로 통신하는 프로토콜은 크게 2가지 방식이 있다. 하나는 HTTP이고 다른 하나는 HTTP2이다.
- 일단 서버와 클라이언트 간의 커넥션은 1개라는 사실에 유념하자. TCP 통신 베이스의 1 커넥션이다.
- HTTP 방식의 경우 통신이 동기 방식이다. 하나의 요청이 서버로 보내졌을 때 서버가 클라이언트에 리스폰스를 주기 전까지 다른 요청들은 블락된다. 따라서 페이지 아래쪽에 있는 이미지가 먼저 로딩이 되어 버리면 페이지 윗쪽의 이미지는 계속 요청이 지연되고 리스폰스가 늦어지게 된다. 이는 서버와 클라이언트 간의 커넥션이 하나이기 때문에 발생한다.
- HTTP2 방식의 경우는 통신이 비동기 방식이다. 서버와 클라이언트 간의 커넥션이 하나라도 여러 요청이 서버로 보내졌을 때 서버는 동시에 이 요청들을 처리한다. 페이지 아래쪽의 이미지가 먼저 로딩이 된다고 하더라도 페이지 위쪽 이미지도 동시에 로딩이 될 수 있기 때문에 특별한 문제가 되지 않는다. 하지만 서버의 트레픽은 제한되어 있는 경우가 있고, 트레픽 제한이 있는 서버에서는 HTTP2 방식을 쓴다고 하더라도 리스폰스의 지연이 생기는 경우가 있다. 이런 트레픽 제한의 문제를 해결하기 위해 CDN 서버를 사용할 때도 있다.
- 또한 서버의 페이지에 로딩되는 추가 파일들 이미지, CSS, JS 파일이 Nginx, Apache 등에서 static 컨텐츠 설정이 되어 있지 않다면 웹 애플리케이션(WAS)에서 데이터를 보내줘야 하기 때문에 지연이 일어날 수 있다. WAS가 동시에 처리할 수 있는 양은 제한 되어 있고 이 제한 때문에 다수의 사용자가 한 꺼번에 많은 컨텐츠를 요청하면 WAS에 무리가 갈 수 있다. 물론 비동기 서버인 NodeJS 같은 경우에는 빠르게 처리할 수도 있을 것 같다.

## Lazy Loading을 어떻게 구현할 것인가?
### 이미지의 경우
```
```

### CSS의 경우
```
```

### JS의 경우
```
```

### 웹펙의 경우
```
```

## Reference
- https://developer.mozilla.org/en-US/docs/Web/Performance/Lazy_loading
- https://webpack.js.org/guides/lazy-loading/
- https://webpack.kr/guides/lazy-loading/
- https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import
